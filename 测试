-- ShadowEtcher ESP + 名字标签 "灰色斧"（轻量版）
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")

local localPlayer = Players.LocalPlayer

-- 配置
local enabled = true
local highlightColor = Color3.fromRGB(255, 100, 0)
local outlineColor = Color3.fromRGB(255, 255, 255)
local fillTransparency = 0.6
local outlineTransparency = 0.0
local nameTextColor = Color3.fromRGB(180, 180, 180)
local nameTextSize = 18

-- 保存每个对象的 {Highlight, BillboardGui}
local applied = {}

-- 为 BasePart 添加 Highlight（仅 Head/PrimaryPart）
local function addHighlight(part)
    if not part or not part:IsA("BasePart") then return nil end
    if applied[part] then return applied[part].Highlight end

    local h = Instance.new("Highlight")
    h.Adornee = part
    h.Name = "ShadowEtcher_Highlight"
    h.Parent = part
    h.FillTransparency = fillTransparency
    h.OutlineTransparency = outlineTransparency
    h.FillColor = highlightColor
    h.OutlineColor = outlineColor
    h.DepthMode = Enum.HighlightDepthMode.Occluded

    applied[part] = {Highlight = h}
    return h
end

-- 为模型添加高亮和名字标签（仅 Head/PrimaryPart）
local function addHighlightAndName(model)
    if not model or applied[model] then return end

    local mainPart = model:FindFirstChild("Head") or model.PrimaryPart
    if mainPart then
        addHighlight(mainPart)

        local billboard = Instance.new("BillboardGui")
        billboard.Name = "ShadowEtcher_NameTag"
        billboard.Adornee = mainPart
        billboard.Size = UDim2.new(0, 100, 0, 25)
        billboard.StudsOffset = Vector3.new(0, 3, 0)
        billboard.AlwaysOnTop = true
        billboard.Parent = mainPart

        local textLabel = Instance.new("TextLabel")
        textLabel.Size = UDim2.new(1, 0, 1, 0)
        textLabel.BackgroundTransparency = 1
        textLabel.TextColor3 = nameTextColor
        textLabel.TextStrokeTransparency = 0
        textLabel.Font = Enum.Font.SourceSansBold
        textLabel.TextSize = nameTextSize
        textLabel.Text = "灰色斧"
        textLabel.Parent = billboard

        applied[model] = {Highlight = mainPart.Highlight, Billboard = billboard}
    end
end

-- 移除高亮和名字标签
local function removeApplied(inst)
    if not inst then return end
    local data = applied[inst]
    if data then
        if data.Highlight then
            pcall(function() data.Highlight:Destroy() end)
        end
        if data.Billboard then
            pcall(function() data.Billboard:Destroy() end)
        end
        applied[inst] = nil
    end
end

-- 判断是否为目标对象
local function isShadowEtcher(obj)
    if not obj then return false end
    if obj:IsA("Model") and obj.Name == "ShadowEtcher" then return true end
    if obj:IsA("BasePart") and obj.Name == "ShadowEtcher" then return true end
    return false
end

-- 监听新对象加入
Workspace.DescendantAdded:Connect(function(desc)
    if not enabled then return end
    task.defer(function()
        if isShadowEtcher(desc) and not applied[desc] then
            if desc:IsA("Model") then
                addHighlightAndName(desc)
            elseif desc:IsA("BasePart") then
                addHighlight(desc)
            end
        end
    end)
end)

-- 监听对象移除
Workspace.DescendantRemoving:Connect(function(desc)
    task.defer(function()
        removeApplied(desc)
    end)
end)

-- 启动时扫描一次已有对象
for _, obj in ipairs(Workspace:GetDescendants()) do
    if isShadowEtcher(obj) then
        if obj:IsA("Model") then
            addHighlightAndName(obj)
        elseif obj:IsA("BasePart") then
            addHighlight(obj)
        end
    end
end

print("ShadowEtcher ESP + 名字标签“灰色斧”（轻量版）已启动。")